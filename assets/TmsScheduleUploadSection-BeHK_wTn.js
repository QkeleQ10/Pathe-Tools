import{d as P,y as O,z as F,c as w,g as l,A as R,a as C,J as L,o as v,x as U,K as N,r as S,u,k as T,i as g,f as y,e as V,w as B}from"./index-C01LYYkr.js";import{d as x,e as z}from"./FileUploadButton-BGcmOUY6.js";import{n as I}from"./nl-Bco7XObu.js";const G=["for"],H={class:"title"},J=["id"],Y=P({__name:"InputCheckbox",props:O({identifier:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const e=F(a,"modelValue");return(t,r)=>(v(),w("label",{class:"input",for:t.identifier},[l("div",H,[C(t.$slots,"default",{},void 0,!0)]),R(l("input",{type:"checkbox",id:t.identifier,"onUpdate:modelValue":r[0]||(r[0]=s=>e.value=s)},null,8,J),[[L,e.value]])],8,G))}}),ne=U(Y,[["__scopeId","data-v-fa1944bc"]]),W=N("tmsSchedule",()=>{const a=S([]),e=S({});async function t(s){return new Promise(async(m,_)=>{const o=s[0];if(!o||!X(o))return;for(;a.value.length;)a.value.pop();e.value={};const c=(await o.text()).split(`
`),d=k(c[0]),A=c.slice(1).map(i=>{const h=k(i);return d.reduce((p,b,$)=>{var D;return p[b.trim()]=(D=h[$])==null?void 0:D.trim(),p},{})}).map(i=>{var h,p;return{title:E(i.PLAYLIST).title,extras:E(i.PLAYLIST).extras,playlist:i.PLAYLIST,feature:i.FEATURE,featureRating:i.FEATURE_RATING,auditorium:i.AUDITORIUM,auditoriumNumber:parseInt((p=(h=i.AUDITORIUM)==null?void 0:h.replace(/^\w+\s/,""))==null?void 0:p.split(" ")[0])||0,scheduledTime:f(i.SCHEDULED_TIME),showTime:f(i.SHOW_TIME),mainShowTime:f(i.FEATURE_TIME),creditsTime:f(i.CREDITS_TIME),endTime:f(i.END_TIME),duration:i.DURATION}});a.value.push(...A),e.value={name:o.name,type:o.type,lastModified:o.lastModified,uploadedDate:Date.now(),size:o.size},m()})}async function r(s){return new Promise((m,_)=>{var c;if(!s||!((c=Object.values(s))!=null&&c[0])||!("timetable"in s)||!("metadata"in s))return _();for(;a.value.length;)a.value.pop();e.value={};const o=s,n=o.timetable.map(d=>({...d,scheduledTime:new Date(d.scheduledTime),showTime:new Date(d.showTime),mainShowTime:new Date(d.mainShowTime),creditsTime:new Date(d.creditsTime),endTime:new Date(d.endTime)}));a.value.push(...n),e.value=o.metadata,m()})}return{table:a,metadata:e,addFiles:t,loadFromJson:r}});function X(a){return a.type==="text/csv"||a.type==="application/vnd.ms-excel"||a.name.endsWith(".csv")}function k(a){const e=[];let t="",r=!1;for(const s of a)s==='"'?r=!r:s===","&&!r?(e.push(t.trim()),t=""):t+=s;return e.push(t.trim()),e}function f(a){const e=new Date;e.getHours()<6&&e.setDate(e.getDate()-1);const t=new Date(`${e.toDateString()} ${a}`);return t.getHours()<6&&t.setDate(t.getDate()+1),t}function E(a){var t;let e=((t=a.match(/(\s((4DX)|(ATMOS)|(IMX)|(3D)|(Music)|(ROOFTOP)|(PrideNight)|(Ladies)|(Premiere)|(\([A-Z]+\))))+/))==null?void 0:t[0].slice(1))||"";return{extras:e.length>0?e.split(" "):[],title:a.replace(e,"").trim()}}const K={id:"upload"},Q={class:"flex block"},Z={key:0,style:{"flex-grow":"1"}},q={key:1,style:{"flex-grow":"1"}},j={class:"buttons"},M="https://kid-daring-robin.ngrok-free.app",ee=P({__name:"TmsScheduleUploadSection",setup(a){const e=W(),t=x("server-username",""),r=x("server-password","");s();async function s(){const n=await(await fetch(`${M}/users/${t.value}/timetable`,{headers:{"ngrok-skip-browser-warning":"true"}})).json();e.loadFromJson(n)}async function m(){await fetch(`${M}/users/${t.value}/timetable`,{method:"POST",headers:{Authorization:"Basic "+btoa(`${t.value}:${r.value}`),"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({timetable:e.table,metadata:e.metadata})})}async function _(o){await e.addFiles(o),m()}return(o,n)=>{const c=z;return v(),w("section",K,[n[4]||(n[4]=l("h2",null,"Gegevensbestand",-1)),l("div",Q,["name"in u(e).metadata?(v(),w("p",Z,[T(g(u(e).metadata.name)+" ",1),n[1]||(n[1]=l("br",null,null,-1)),l("small",null,[T(" Laatst gewijzigd op "+g(u(y)(new Date(u(e).metadata.lastModified),"PPPpp",{locale:u(I)}))+" ",1),n[0]||(n[0]=l("br",null,null,-1)),T(" Geüpload op "+g(u(y)(new Date(u(e).metadata.uploadedDate),"PPPpp",{locale:u(I)})),1)])])):(v(),w("p",q,n[2]||(n[2]=[T(" Geen bestand geüpload "),l("br",null,null,-1),l("small",null,"Upload hiernaast een CSV-bestand uit RosettaBridge (met optie 'times only')",-1)]))),l("div",j,[V(c,{id:"file-upload-area",class:"large",onFilesUploaded:_,accept:"text/csv,.csv"},{default:B(()=>n[3]||(n[3]=[l("small",null,"Of sleep een bestand hiernaartoe",-1)])),_:1})])])])}}}),ie=U(ee,[["__scopeId","data-v-13ee9368"]]);export{ie as _,ne as a,W as u};

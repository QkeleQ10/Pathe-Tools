import{d as D,r as k,b as x,f as m,c as l,e as u,g as t,h as f,_ as j,u as n,w as _,k as i,s as S,i as V,o as a,x as $}from"./index-CyVwY3Wf.js";import{u as C,_ as L}from"./TimetableUploadSection-BB8kR1ci.js";import{c as U,a as I}from"./FileUploadBlock-BVqFoQJB.js";import{u as P}from"./server-B_AbROc7.js";import"./nl-4DAbi5Re.js";const z={class:"flex",style:{"flex-wrap":"wrap-reverse"}},B={style:{flex:"100% 1 1"}},N={key:0,class:"block"},E={key:1,class:"block"},O={key:2,class:"block"},R={key:3,class:"block"},Z={key:4,class:"block"},H={key:5,class:"block"},M={key:6,class:"block"},K={key:0,class:"dropzone"},X=D({__name:"NarrowcastingView",setup(A){const o=C(),c=P(),d=U("history"),g=k(!1);o.$subscribe(()=>{var r;if(!d.download||!((r=o.table)!=null&&r.length)||b.value.length<10||g.value)return;const s=new Blob([b.value],{type:"text/plain"}),e=document.createElement("a");e.href=URL.createObjectURL(s),e.download="timetable.xml",e.click(),URL.revokeObjectURL(e.href),g.value=!0});const b=x(()=>{const s=r=>"  ".repeat(r),e=o.table.map((r,p)=>w(r,p).split("><").join(`>
${s(2)}<`)).join(`
${s(1)}`);return`<voorstellingen>
${s(1)}${e}
</voorstellingen>`});function w(s,e){return`<Shows><ID type="Long Integer">${e}</ID><DatumVan type="Date/Time">${m(s.scheduledTime,"dd-MM-yyyy")}</DatumVan><DatumTot type="Date/Time">${m(s.scheduledTime,"dd-MM-yyyy")}</DatumTot><Tijd type="Date/Time">${m(s.scheduledTime,"HH:mm")}</Tijd><Titel type="Text">${s.playlist}</Titel><Zaal type="Text">${s.auditoriumNumber}</Zaal><Kleur type="Long Integer">3</Kleur><Permanent type="Long Integer">1</Permanent></Shows>`}function T(){d.url="https://pathe-tools-server.onrender.com",c.url="https://pathe-tools-server.onrender.com",o.connect()}const v=k(null),{isOverDropZone:h}=I(v,{onDrop:o.filesUploaded,multiple:!1});return(s,e)=>{const r=j,p=L,y=S;return a(),l("main",{ref_key:"main",ref:v},[u(r),u(p),t("section",null,[t("div",z,[t("div",B,[e[12]||(e[12]=t("h2",{style:{"margin-bottom":"0"}},"Timetable-matrixdisplay",-1)),e[13]||(e[13]=t("p",null,"Dit is een tijdelijke tool waarmee je het matrixdisplay van de Pathé Timetable kunt vullen. Volg de instructies hieronder.",-1)),n(c).url==="http://localhost:3541"?(a(),l("div",N,[e[1]||(e[1]=t("p",null," Het serveradres is niet ingesteld. ",-1)),u(y,{class:"primary",onClick:T},{default:_(()=>e[0]||(e[0]=[i("Oplossen")])),_:1})])):["send-error","receive-error","no-credentials","no-connection","error"].includes(n(o).status)?(a(),l("div",E,[e[3]||(e[3]=t("p",null," Er is geen verbinding met de server. Controleer de inloggegevens. ",-1)),u(y,{class:"primary",onClick:n(o).connect},{default:_(()=>e[2]||(e[2]=[i("Opnieuw verbinden")])),_:1},8,["onClick"])])):["sending","receiving"].includes(n(o).status)?(a(),l("div",O,e[4]||(e[4]=[t("p",null," Een ogenblik geduld... ",-1)]))):!n(d).download&&!n(o).table.length&&["sent","received"].includes(n(o).status)?(a(),l("div",R,e[5]||(e[5]=[t("p",null,[i(" Upload een "),t("b",null,"TSV"),i("-bestand uit RosettaBridge (optie "),t("b",null,"Dates - ISO"),i(") met de knop of door hem hierheen te slepen. Let op dat je het bestand voor de juiste datum uploadt. ")],-1)]))):n(d).download&&!n(o).table.length&&["sent","received"].includes(n(o).status)?(a(),l("div",Z,e[6]||(e[6]=[t("p",null," Er is nog geen bestand geüpload! Ga naar de RosettaBridge-PC en open deze pagina. ",-1)]))):!n(d).download&&n(o).table.length&&["sent","received"].includes(n(o).status)?(a(),l("div",H,[t("p",null,[i(" De bovenstaande gegevens zijn "+V(n(o).status==="sent"?"geüpload naar":"al aanwezig op")+" de server. ",1),e[7]||(e[7]=t("br",null,null,-1)),e[8]||(e[8]=t("br",null,null,-1)),e[9]||(e[9]=i(" Als dit het juiste bestand is, ga dan naar de timetable-PC en doe het volgende: "))]),e[10]||(e[10]=t("ol",null,[t("li",null,"Zorg ervoor dat de software voor de Pathé Timetable open staat."),t("li",null,"Dubbelklik op het bestandje 'Voorstellingen ophalen van Pathé Tools.bat'.")],-1))])):n(d).download&&n(o).table.length&&["sent","received"].includes(n(o).status)?(a(),l("div",M,e[11]||(e[11]=[t("p",null," De bovenstaande gegevens zijn aanwezig op de server. Er wordt zometeen een bestand gedownload. Zorg ervoor dat dit bestand wordt gedownload als 'timetable.xml' in de standaarddownloadmap, als dat niet automatisch gebeurt. ",-1)]))):f("",!0)])])]),n(h)?(a(),l("div",K," Laat los om bestand te uploaden ")):f("",!0)],512)}}}),W=$(X,[["__scopeId","data-v-69d55515"]]);export{W as default};

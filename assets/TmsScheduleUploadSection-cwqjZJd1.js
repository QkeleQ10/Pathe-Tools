import{d as P,y as O,z as F,c as T,g as r,A as R,a as C,J as L,o as v,x as U,K as N,r as g,u,k as w,i as D,f as y,e as V,w as B}from"./index-DgXSe68A.js";import{d as z,e as x,f as G}from"./FileUploadButton-DekjYQdv.js";import{n as I}from"./nl-EGEvegyS.js";const H=["for"],J={class:"title"},Y=["id"],W=P({__name:"InputCheckbox",props:O({identifier:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const e=F(a,"modelValue");return(t,o)=>(v(),T("label",{class:"input",for:t.identifier},[r("div",J,[C(t.$slots,"default",{},void 0,!0)]),R(r("input",{type:"checkbox",id:t.identifier,"onUpdate:modelValue":o[0]||(o[0]=n=>e.value=n)},null,8,Y),[[L,e.value]])],8,H))}}),ie=U(W,[["__scopeId","data-v-fa1944bc"]]),X=N("tmsSchedule",()=>{const a=g([]),e=g({});async function t(n){return new Promise(async(m,h)=>{const l=n[0];if(!l||!K(l))return;for(;a.value.length;)a.value.pop();e.value={};const s=(await l.text()).split(`
`),d=k(s[0]),b=s.slice(1).map(i=>{const _=k(i);return d.reduce((p,A,$)=>{var S;return p[A.trim()]=(S=_[$])==null?void 0:S.trim(),p},{})}).map(i=>{var _,p;return{title:E(i.PLAYLIST).title,extras:E(i.PLAYLIST).extras,playlist:i.PLAYLIST,feature:i.FEATURE,featureRating:i.FEATURE_RATING,auditorium:i.AUDITORIUM,auditoriumNumber:parseInt((p=(_=i.AUDITORIUM)==null?void 0:_.replace(/^\w+\s/,""))==null?void 0:p.split(" ")[0])||0,scheduledTime:f(i.SCHEDULED_TIME),showTime:f(i.SHOW_TIME),mainShowTime:f(i.FEATURE_TIME),creditsTime:f(i.CREDITS_TIME),endTime:f(i.END_TIME),duration:i.DURATION}});a.value.push(...b),e.value={name:l.name,type:l.type,lastModified:l.lastModified,uploadedDate:Date.now(),size:l.size},m()})}async function o(n){return new Promise((m,h)=>{var s;if(!n||!((s=Object.values(n))!=null&&s[0])||!("timetable"in n)||!("metadata"in n))return h();for(;a.value.length;)a.value.pop();e.value={};const l=n,c=l.timetable.map(d=>({...d,scheduledTime:new Date(d.scheduledTime),showTime:new Date(d.showTime),mainShowTime:new Date(d.mainShowTime),creditsTime:new Date(d.creditsTime),endTime:new Date(d.endTime)}));a.value.push(...c),e.value=l.metadata,m()})}return{table:a,metadata:e,addFiles:t,loadFromJson:o}});function K(a){return a.type==="text/csv"||a.type==="application/vnd.ms-excel"||a.name.endsWith(".csv")}function k(a){const e=[];let t="",o=!1;for(const n of a)n==='"'?o=!o:n===","&&!o?(e.push(t.trim()),t=""):t+=n;return e.push(t.trim()),e}function f(a){const e=new Date;e.getHours()<6&&e.setDate(e.getDate()-1);const t=new Date(`${e.toDateString()} ${a}`);return t.getHours()<6&&t.setDate(t.getDate()+1),t}function E(a){var t;let e=((t=a.match(/(\s((4DX)|(ATMOS)|(IMX)|(3D)|(Music)|(ROOFTOP)|(PrideNight)|(Ladies)|(Premiere)|(\([A-Z]+\))))+/))==null?void 0:t[0].slice(1))||"";return{extras:e.length>0?e.split(" "):[],title:a.replace(e,"").trim()}}const Q={id:"upload"},Z={class:"flex block"},q={key:0,style:{"flex-grow":"1"}},j={key:1,style:{"flex-grow":"1"}},ee={class:"buttons"},M="https://kid-daring-robin.ngrok-free.app",te=P({__name:"TmsScheduleUploadSection",setup(a){const e=X(),t=z("history"),o=t.username?g(t.username):x("server-username",""),n=t.password?g(t.password):x("server-password","");m();async function m(){const s=await(await fetch(`${M}/users/${o.value}/timetable`,{headers:{"ngrok-skip-browser-warning":"true"}})).json();e.loadFromJson(s)}async function h(){await fetch(`${M}/users/${o.value}/timetable`,{method:"POST",headers:{Authorization:"Basic "+btoa(`${o.value}:${n.value}`),"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({timetable:e.table,metadata:e.metadata})})}async function l(c){await e.addFiles(c),h()}return(c,s)=>{const d=G;return v(),T("section",Q,[s[4]||(s[4]=r("h2",null,"Gegevensbestand",-1)),r("div",Z,["name"in u(e).metadata?(v(),T("p",q,[w(D(u(e).metadata.name)+" ",1),s[1]||(s[1]=r("br",null,null,-1)),r("small",null,[w(" Laatst gewijzigd op "+D(u(y)(new Date(u(e).metadata.lastModified),"PPPpp",{locale:u(I)}))+" ",1),s[0]||(s[0]=r("br",null,null,-1)),w(" Geüpload op "+D(u(y)(new Date(u(e).metadata.uploadedDate),"PPPpp",{locale:u(I)})),1)])])):(v(),T("p",j,s[2]||(s[2]=[w(" Geen bestand geüpload "),r("br",null,null,-1),r("small",null,"Upload hiernaast een CSV-bestand uit RosettaBridge (met optie 'times only')",-1)]))),r("div",ee,[V(d,{id:"file-upload-area",class:"large",onFilesUploaded:l,accept:"text/csv,.csv"},{default:B(()=>s[3]||(s[3]=[r("small",null,"Of sleep een bestand hiernaartoe",-1)])),_:1})])])])}}}),oe=U(te,[["__scopeId","data-v-8f7583b6"]]);export{oe as _,ie as a,X as u};

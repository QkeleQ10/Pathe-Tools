var ne=Object.defineProperty;var se=(y,e,o)=>e in y?ne(y,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):y[e]=o;var h=(y,e,o)=>se(y,typeof e!="symbol"?e+"":e,o);import{a as oe,_ as le,u as ae}from"./server-DdQFNliv.js";import{d as W,r as j,c as v,F as Z,q as K,h as S,g as T,w as k,m as J,b as n,K as ie,k as X,j as U,y as G,l as c,f as D,o as g,_ as Y,e as re,i as de,u as i,v as ue,s as q}from"./index-C5ES1AEp.js";import{b as Q,a as me}from"./FileUploadBlock-BvVb1z_4.js";import{u as ee,I as pe,_ as ge}from"./TimetableUploadSection-DKCh8rrd.js";import"./nl-CmXxS_wI.js";class O{constructor(e=65535,o=65535,r){h(this,"packet");let l;if(r instanceof Uint8Array)l=r;else if(Array.isArray(r)){l=new Uint8Array(r.reduce((p,V)=>p+V.messageBody.length,0));let f=0;for(const p of r)l.set(p.messageBody,f),f+=p.messageBody.length}else l=r.messageBody;const m=new Uint8Array(9);m.set([170,187,e>>8,e&255,o>>8,o&255,l.length>>8,l.length&255,e>>8^e&255^o>>8^o&255^l.length>>8^l.length&255]);const b=new Uint8Array(1);b.set([l.reduce((f,p)=>f^p,0)]),this.packet=new Uint8Array(m.length+l.length+b.length),this.packet.set(m),this.packet.set(l,m.length),this.packet.set(b,m.length+l.length)}toString(){return Array.from(this.packet).map(e=>e.toString(16).padStart(2,"0")).join(" ").toUpperCase()}}class F{constructor(){h(this,"messageBody")}}h(F,"functionCode",0);class E extends F{constructor(e){super();let o;if(e instanceof Uint8Array)o=e;else if(Array.isArray(e)){o=new Uint8Array(e.reduce((m,b)=>m+b.messageBody.length,0));let l=0;for(const m of e)o.set(m.messageBody,l),l+=m.messageBody.length}else o=e.messageBody;const r=new Uint8Array(1+o.length);r.set([this.constructor.functionCode]),r.set(o,1),this.messageBody=r}}h(E,"functionCode",0);class te extends F{constructor(e){super();const o=new Uint8Array(8);o.set([this.constructor.functionCode]),o.set([e.getFullYear()-2e3,e.getMonth()+1,e.getDate(),e.getDay(),e.getHours(),e.getMinutes(),e.getSeconds()],1),this.messageBody=o}}h(te,"functionCode",1);class H{constructor(){h(this,"messageBody")}}h(H,"commandCode",0);const L=class L extends H{constructor(){super();const e=new Uint8Array(1);e.set([L.commandCode]),this.messageBody=e}};h(L,"commandCode",1);let I=L;const M=class M extends H{constructor(e=0,o=3,r=0,l=0,m=0,b){super();const f=ve(b),p=new Uint8Array(6+f.length+1);p.set([M.commandCode]),p.set([e,o,r,l,m],1),p.set(f,6),p.set([0],p.length-1),this.messageBody=p}};h(M,"commandCode",3);let C=M;const N=class N extends H{constructor(e=0,o=0,r=9){super();const l=new Uint8Array(5);l.set([N.commandCode]),l.set([e>>8,e&255,o,r],1),this.messageBody=l}};h(N,"commandCode",7);let P=N;const R=class R extends H{constructor(){super();const e=new Uint8Array(1);e.set([R.commandCode]),this.messageBody=e}};h(R,"commandCode",31);let z=R;const ce={"":0,"":1,"":2,"":3,"":4,"":5,"":6,"\x07":7,"\b":8,"	":9,"\n":10,"\v":11,"\f":12,"\r":13,"":14,"":15,"":16,"":17,"":18,"":19,"":20,"":21,"":22,"":23,"":24,"":25,"":26,"\x1B":27,"":28,"":29,"":30,"":31," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,"":127,"Â€":128,"Â":129,"Â‚":130,"Âƒ":131,"Â„":132,"Â…":133,"Â†":134,"Â‡":135,"Âˆ":136,"Â‰":137,"ÂŠ":138,"Â‹":139,"ÂŒ":140,"Â":141,"ÂŽ":142,"Â":143,"Â":144,"Â‘":145,"Â’":146,"Â“":147,"Â”":148,"Â•":149,"Â–":150,"Â—":151,"Â˜":152,"Â™":153,"Âš":154,"Â›":155,"Âœ":156,"Â":157,"Âž":158,"ÂŸ":159,"Â ":160,"Â¡":161,"Â¢":162,"Â£":163,"Â¤":164,"Â¥":165,"Â¦":166,"Â§":167,"Â¨":168,"Â©":169,Âª:170,"Â«":171,"Â¬":172,"Â­":173,"Â®":174,"Â¯":175,"Â°":176,"Â±":177,"Â²":178,"Â³":179,"Â´":180,Âµ:181,"Â¶":182,"Â·":183,"Â¸":184,"Â¹":185,Âº:186,"Â»":187,"Â¼":188,"Â½":189,"Â¾":190,"Â¿":191,Ã€:192,Ã:193,Ã‚:194,Ãƒ:195,Ã„:196,Ã…:197,Ã†:198,Ã‡:199,Ãˆ:200,Ã‰:201,ÃŠ:202,Ã‹:203,ÃŒ:204,Ã:205,ÃŽ:206,Ã:207,Ã:208,Ã‘:209,Ã’:210,Ã“:211,Ã”:212,Ã•:213,Ã–:214,"Ã—":215,Ã˜:216,Ã™:217,Ãš:218,Ã›:219,Ãœ:220,Ã:221,Ãž:222,ÃŸ:223,Ã :224,Ã¡:225,Ã¢:226,Ã£:227,Ã¤:228,Ã¥:229,Ã¦:230,Ã§:231,Ã¨:232,Ã©:233,Ãª:234,Ã«:235,Ã¬:236,Ã­:237,Ã®:238,Ã¯:239,Ã°:240,Ã±:241,Ã²:242,Ã³:243,Ã´:244,Ãµ:245,Ã¶:246,"Ã·":247,Ã¸:248,Ã¹:249,Ãº:250,Ã»:251,Ã¼:252,Ã½:253,Ã¾:254,Ã¿:255};function ve(y){const e=y.split("").map(o=>ce[o]??0);return new Uint8Array(e)}const ye={class:"flex"},be={class:"flex"},fe={style:{width:"48ch"}},we={style:{width:"16ch"}},he=W({__name:"CinemecTimetableTest",setup(y){const e=Q("history"),o=ee(),r=j(!!e.prototype),l=j("http://localhost:5000/send-bytes"),m=j("10.10.87.81"),b=j("10.10.87.82"),f=j("9100"),p=j(!1),V={testMessage:()=>new O(null,null,new E([new I,new C(null,3,0,55,0,D(new Date,"HH:mm")),new C(null,2,0,0,2,B("Welkom bij PathÃ© Utrecht Leidsche Rijn!",60)),new C(null,3,0,0,3,B("De timetable toont momenteel geen actuele",60)),new C(null,3,0,0,4,B("informatie. Raadpleeg uw ticket of de",60)),new C(null,3,0,0,5,B("schermen bij de kassa voor het zaalnummer.",60)),new P(null,20,5),new z])),setClock:()=>new O(null,null,new te(new Date)),schedule:()=>new O(null,null,new E([new I,new C(null,3,0,55,0,D(new Date,"HH:mm")),new C(null,2,0,0,1,"Welkom bij PathÃ© Utrecht Leidsche Rijn!                 Zaal"),...o.table.filter(d=>d.scheduledTime.getTime()-Date.now()>-9e5).sort((d,s)=>d.scheduledTime.getTime()-s.scheduledTime.getTime()).slice(0,7).map((d,s)=>new C(null,3,0,0,s+2,`${D(d.scheduledTime,"HH:mm")} ${d.title.substring(0,37).padEnd(37)} ${d.scheduledTime.getTime()-Date.now()<3e5?"~F;~C1;":"~C0;"}${d.scheduledTime.getTime()-Date.now()<-54e4?"   is gestart":"gaat beginnen"} ~N;~I;~C3;${d.auditoriumNumber.toString().substring(0,2).padStart(2)}`)),new P(null,20,5),new z]))},u=j(V.testMessage().toString());async function t(){if(m.value){let d=await fetch(l.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:m.value,port:f.value,hex:u.value})});console.log(d)}if(b.value){let d=await fetch(l.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:b.value,port:f.value,hex:u.value})});console.log(d)}p.value&&setTimeout(()=>{u.value=V.schedule().toString(),t()},3e4)}function _(d){return d.trim().split(/\s+/).map(w=>{const A=parseInt(w,16);return String.fromCharCode(A)}).join("")}function B(d,s,x=" "){const w=Math.floor((s-d.length)/2);return x.repeat(w)+d+x.repeat(s-d.length-w)}return(d,s)=>{const x=G,w=oe,A=le;return g(),v(Z,null,[r.value?(g(),K(A,{key:0,onDismiss:s[6]||(s[6]=a=>r.value=!1)},{default:k(()=>[J(n("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>u.value=a),identifier:"input"},null,512),[[ie,u.value]]),n("div",ye,[(g(!0),v(Z,null,X(Object.keys(V),a=>(g(),K(x,{class:"secondary",onClick:$=>u.value=V[a]().toString()},{default:k(()=>[c(U(a),1)]),_:2},1032,["onClick"]))),256))]),n("div",be,[n("pre",fe,U(u.value),1),n("pre",we,U(_(u.value).replace(/[\n\r\t]/g," ").match(/.{1,16}/g).join(`
`)),1)]),T(w,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=a=>l.value=a),identifier:"host"},{default:k(()=>s[8]||(s[8]=[n("span",null,"host",-1)])),_:1,__:[8]},8,["modelValue"]),T(w,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=a=>m.value=a),identifier:"ip"},{default:k(()=>s[9]||(s[9]=[n("span",null,"ip",-1)])),_:1,__:[9]},8,["modelValue"]),T(w,{modelValue:b.value,"onUpdate:modelValue":s[3]||(s[3]=a=>b.value=a),identifier:"ip2"},{default:k(()=>s[10]||(s[10]=[n("span",null,"ip2",-1)])),_:1,__:[10]},8,["modelValue"]),T(w,{modelValue:f.value,"onUpdate:modelValue":s[4]||(s[4]=a=>f.value=a),identifier:"port"},{default:k(()=>s[11]||(s[11]=[n("span",null,"port",-1)])),_:1,__:[11]},8,["modelValue"]),T(pe,{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=a=>p.value=a),identifier:"repeat"},{default:k(()=>s[12]||(s[12]=[n("span",null,"repeat",-1)])),_:1,__:[12]},8,["modelValue"]),T(x,{onClick:t},{default:k(()=>s[13]||(s[13]=[c("sendRequest")])),_:1,__:[13]})]),_:1})):S("",!0),T(x,{class:"secondary",onClick:s[7]||(s[7]=a=>r.value=!0),style:{opacity:"0.2"}},{default:k(()=>s[14]||(s[14]=[c("Prototype-test")])),_:1,__:[14]})],64)}}}),Te=Y(he,[["__scopeId","data-v-2ce76788"]]),ke={style:{display:"grid","grid-template-columns":"1fr auto",gap:"32px"}},_e={id:"instructions"},xe={key:0},Ce={key:1},Ue={key:2},je={key:3},Ve={key:4},Be={key:5},$e={key:6},De={style:{"max-width":"560px"}},Ae={key:0},Se={key:1},He={class:"block",id:"matrix-display"},Ie={class:"matrix-clock"},Pe={class:"col"},ze={class:"col"},Le={class:"col"},Me={key:0,class:"dropzone"},Ne=W({__name:"NarrowcastingView",setup(y){const e=ee(),o=ae(),r=Q("history"),l=j(!1);e.$subscribe(()=>{var _;if(!r.download||!((_=e.table)!=null&&_.length)||m.value.length<10||l.value)return;const u=new Blob([m.value],{type:"text/plain"}),t=document.createElement("a");t.href=URL.createObjectURL(u),t.download="timetable.xml",t.click(),URL.revokeObjectURL(t.href),l.value=!0});const m=re(()=>{const u=_=>"  ".repeat(_),t=e.table.map((_,B)=>b(_,B).split("><").join(`>
${u(2)}<`)).join(`
${u(1)}`);return`<voorstellingen>
${u(1)}${t}
</voorstellingen>`});function b(u,t){return`<Shows><ID type="Long Integer">${t}</ID><DatumVan type="Date/Time">${D(u.scheduledTime,"dd-MM-yyyy")}</DatumVan><DatumTot type="Date/Time">${D(u.scheduledTime,"dd-MM-yyyy")}</DatumTot><Tijd type="Date/Time">${D(u.scheduledTime,"HH:mm")}</Tijd><Titel type="Text">${u.playlist}</Titel><Zaal type="Text">${u.auditoriumNumber}</Zaal><Kleur type="Long Integer">3</Kleur><Permanent type="Long Integer">1</Permanent></Shows>`}function f(){r.url="https://pathe-tools-server.onrender.com",o.url="https://pathe-tools-server.onrender.com",e.connect()}const p=j(null),{isOverDropZone:V}=me(p,{onDrop:e.filesUploaded,multiple:!1});return(u,t)=>{var x,w,A;const _=de,B=ge,d=G,s=Te;return g(),v("main",{ref_key:"main",ref:p},[T(_),T(B),n("section",null,[n("div",ke,[n("div",_e,[t[12]||(t[12]=n("h2",null,"Timetable vullen",-1)),i(o).url==="http://localhost:3541"?(g(),v("div",xe,[t[1]||(t[1]=n("p",null," Het serveradres is niet ingesteld. ",-1)),T(d,{class:"primary",onClick:f},{default:k(()=>t[0]||(t[0]=[c("Oplossen")])),_:1,__:[0]})])):["send-error","receive-error","no-credentials","no-connection","error"].includes(i(e).status)?(g(),v("div",Ce,[t[3]||(t[3]=n("p",null," Er is geen verbinding met de server. Controleer de inloggegevens. ",-1)),T(d,{class:"primary",onClick:i(e).connect},{default:k(()=>t[2]||(t[2]=[c("Opnieuw verbinden")])),_:1,__:[2]},8,["onClick"])])):["sending","receiving"].includes(i(e).status)?(g(),v("div",Ue,t[4]||(t[4]=[n("p",null," Er wordt verbinding gemaakt. Een ogenblik geduld... ",-1)]))):!i(r).download&&!i(e).table.length&&["sent","received"].includes(i(e).status)?(g(),v("div",je,t[5]||(t[5]=[n("p",null,[c(" Upload een "),n("b",null,"TSV"),c("-bestand uit RosettaBridge (optie "),n("b",null,"Dates - ISO"),c(") met de knop of door hem hierheen te slepen. Let op dat je het bestand voor de juiste datum uploadt. ")],-1)]))):i(r).download&&!i(e).table.length&&["sent","received"].includes(i(e).status)?(g(),v("div",Ve,t[6]||(t[6]=[n("p",null," Er is nog geen bestand geÃ¼pload! Ga naar de RosettaBridge-PC en open deze pagina. ",-1)]))):!i(r).download&&i(e).table.length&&["sent","received"].includes(i(e).status)?(g(),v("div",Be,[n("p",null,[c(" De weergegeven gegevens zijn "+U(i(e).status==="sent"?"geÃ¼pload naar":"al aanwezig op")+" de server. ",1),t[7]||(t[7]=n("br",null,null,-1)),t[8]||(t[8]=n("br",null,null,-1)),t[9]||(t[9]=c(" Als dit het juiste bestand is, ga dan naar de Timetable-PC en doe het volgende: "))]),t[10]||(t[10]=n("ol",null,[n("li",null,"Zorg ervoor dat het softwareprogramma 'CineMec TimeTable' (Ã©Ã©n keer) open staat."),n("li",null,"Dubbelklik op het bestandje op het bureaublad genaamd 'Voorstellingen ophalen van PathÃ© Tools.bat'.")],-1))])):i(r).download&&i(e).table.length&&["sent","received"].includes(i(e).status)?(g(),v("div",$e,t[11]||(t[11]=[n("p",null," De weergegeven gegevens zijn aanwezig op de server. Er wordt nu een bestand gedownload. Zorg ervoor dat dit bestand wordt opgeslagen als 'timetable.xml' in de standaarddownloadmap, als dat niet automatisch gebeurt. Klik eventueel op 'Behouden'. ",-1)]))):S("",!0),T(s)]),J(n("div",null,[t[24]||(t[24]=n("h2",null,"Voorbeeld",-1)),n("p",De,[t[14]||(t[14]=c(" Dit is slechts een voorbeeld. Deze pagina staat ")),t[15]||(t[15]=n("u",null,"niet",-1)),t[16]||(t[16]=c(" in directe verbinding met de Timetable.")),t[17]||(t[17]=n("br",null,null,-1)),t[18]||(t[18]=n("br",null,null,-1)),((x=i(e).table.sort((a,$)=>a.scheduledTime.getTime()-$.scheduledTime.getTime())[0])==null?void 0:x.scheduledTime)>new Date(new Date().setHours(0,0,0,0)+24*60*60*1e3)?(g(),v("span",Ae,t[13]||(t[13]=[c(" Als je deze gegevens inlaadt in de Timetable, dan worden ze pas vanaf middernacht weergegeven. "),n("br",null,null,-1),n("br",null,null,-1)]))):S("",!0),i(e).table.some(a=>a.playlist.length>37)?(g(),v("span",Se," Sommige titels zijn te lang en moeten mogelijk nog worden verkort ("+U(i(e).table.filter(a=>a.playlist.length>37).length)+"Ã—). ",1)):S("",!0)]),n("div",He,[t[22]||(t[22]=n("span",{id:"matrix-display-title"},"PathÃ© Timetable",-1)),n("pre",Ie,U(i(D)(((A=(w=i(e).table)==null?void 0:w[0])==null?void 0:A.scheduledTime.getTime())+84e4||new Date,"HH:mm")),1),t[23]||(t[23]=n("pre",{class:"matrix-row green"},"        Welkom bij PathÃ© Utrecht Leidsche Rijn!         Zaal",-1)),(g(!0),v(Z,null,X(i(e).table.sort((a,$)=>a.scheduledTime.getTime()-$.scheduledTime.getTime()),(a,$)=>(g(),v("pre",{class:q(["matrix-row",{overflowing:a.playlist.length>37}])},[n("div",Pe,U(i(D)(a.scheduledTime,"HH:mm")),1),t[19]||(t[19]=c()),n("div",ze,U(a.playlist),1),t[20]||(t[20]=c()),n("div",{class:q(["col",{blink:$===1}])},U($===0?"is gestart":$===1?"gaat beginnen":""),3),t[21]||(t[21]=c()),n("div",Le,U(a.auditoriumNumber||"?"),1)],2))),256))])],512),[[ue,i(e).table.length&&["sent","received"].includes(i(e).status)]])])]),i(V)?(g(),v("div",Me," Laat los om bestand te uploaden ")):S("",!0)],512)}}}),qe=Y(Ne,[["__scopeId","data-v-181798c2"]]);export{qe as default};

var ve=Object.defineProperty;var we=(n,u,d)=>u in n?ve(n,u,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[u]=d;var P=(n,u,d)=>we(n,typeof u!="symbol"?u+"":u,d);import{_ as te,a as re}from"./server-C1MKfvFx.js";import{b as de,_ as Ve,a as Te}from"./InputNumber-FHbXogqi.js";import{d as z,A as W,B as F,c,F as B,q as E,h as x,g as f,w as r,a as ee,b as s,C as le,l as p,D as he,T as oe,k as R,y as ne,o as a,j as O,u as $,_ as Z,m as me,E as be,r as H,s as J,G as ue,H as Se,I as Oe,i as ke,J as $e,K as Ue,p as K,f as Y,v as xe}from"./index-DZWO0BRC.js";import{a as fe,u as Ne,_ as Me}from"./TimetableUploadSection-BBoxkI3F.js";import{u as Q,a as Ce,_ as De}from"./FileUploadBlock-BvRmUCqp.js";import{_ as Ae}from"./Chip-DhoMRpSJ.js";import"./nl-BqLzONBH.js";const Be="/Pathe-Tools/assets/rosetta-Cn53EfYD.ogg",Ee="/Pathe-Tools/assets/gerwim-CqHIXSuO.ogg",Ie="/Pathe-Tools/assets/jaron-CS_9Sx9l.ogg",Re="/Pathe-Tools/assets/danique-C_bjxFfD.ogg";class X{constructor(u){P(this,"name");P(this,"language");P(this,"file");P(this,"sprite");this.name=u.name,this.language=u.language,this.file=u.file,this.sprite=u.sprite}get sounds(){return Object.keys(this.sprite)}get additionalSounds(){return this.sounds.filter(u=>!A.default.sounds.includes(u))}}const A={default:new X({name:"Rosetta",language:"nl",file:Be,sprite:{auditorium01:[0,937.0294784580499],auditorium02:[1200,982.9931972789117],auditorium03:[2400,863.6281179138323],auditorium04:[3600,1022.8571428571427],auditorium05:[5800,1023.1065759637188],auditorium06:[8e3,1016.2585034013603],auditorium07:[10200,1187.2335600907036],auditorium08:[12400,1109.2290249433106],auditorium09:[14600,1185.2154195011337],auditorium10:[16800,959.9773242630398],auditorium11:[18000.000000000004,1122.6077097505681],auditorium12:[20200.000000000004,1185.8049886621309],auditorium13:[22400.000000000004,1159.6825396825388],auditorium14:[24600,1169.5918367346926],auditorium15:[26800,1240.1360544217682],auditorium16:[29e3,1161.0884353741503],auditorium17:[31200,1213.2426303854907],auditorium18:[33400.00000000001,1123.990929705215],auditorium19:[35600.00000000001,1342.7664399092976],auditorium20:[37800.000000000015,1263.8321995464848],chime:[40000.000000000015,3084.51247165533],credits:[44200.000000000015,924.7165532879791],end:[45400.000000000015,1289.478458049885],mainshow:[47600.00000000001,1445.963718820863],preshow:[49800.000000000015,1364.3990929705226],start:[52000.000000000015,686.9841269841288]}}),gerwim:new X({name:"Gerwim",language:"nl",file:Ee,sprite:{auditorium01:[0,824.9659863945578],auditorium02:[1200,870.907029478458],auditorium03:[2400,790.2040816326532],auditorium04:[3600,886.825396825397],auditorium05:[4800,838.526077097506],auditorium06:[6e3,866.7573696145121],auditorium07:[7199.999999999999,987.7777777777776],auditorium10:[8399.999999999998,665.6689342403635],credits:[9600,936.5532879818588],start:[10799.999999999998,638.9342403628114]}}),jaron:new X({name:"Jaron",language:"nl",file:Ie,sprite:{auditorium01:[0,996.2585034013606],auditorium02:[1200,977.2562358276645],auditorium03:[2400,1053.9229024943313],auditorium04:[4600,1109.8866213151925],auditorium05:[6799.999999999999,1125.5328798185947],auditorium06:[9e3,1083.7641723356005],auditorium07:[11200,1070.2947845804988],auditorium08:[13399.999999999998,1134.9206349206345],auditorium09:[15599.999999999998,1259.2517006802736],auditorium10:[17800,750.5895691609971],credits:[19e3,920.6575963718819],end:[20200,1177.0748299319714],finalshow:[22400,1377.0068027210875],mainshow:[24599.999999999996,1302.0634920634925],start:[26799.999999999996,737.8458049886625]}}),danique:new X({name:"Danique",language:"nl",file:Re,sprite:{auditorium01:[0,737.9591836734694],auditorium02:[1200,820.340136054422],auditorium03:[2400.0000000000005,677.482993197279],auditorium04:[3600.0000000000005,822.6530612244902],auditorium05:[4800.000000000001,810.5442176870747],auditorium06:[6000.000000000001,795.4875283446717],auditorium07:[7200.000000000001,926.8027210884355],auditorium08:[8400,871.0430839002274],auditorium09:[9600.000000000002,941.8820861677997],auditorium10:[10800,689.569160997733],credits:[12000.000000000002,786.3718820861685],end:[13200.000000000004,1149.2743764172335],start:[15400.000000000002,520.2040816326523]}})};function q(n){const u={start:"start",mainshow:"start hoofdfilm",credits:"aftiteling",end:"einde voorstelling",preshow:"start voorprogramma",finalshow:"laatste voorstelling",chime:"♪"};n=n.toLowerCase().trim();let d=n.replace(/\?+/g,""),_=u[d]||d,v=Object.values(A).some(e=>e.sounds.includes(d)),b=1/Math.pow(2,(n.match(/\?+/g)||[""])[0].length);n.includes("|")&&(_=n.split("|").map(e=>q(e).name).join("|"),v=_.split("|").every(e=>e!==d),b=1);let k=d.match(/^(auditorium)([0-9]+|(#))$/);return k&&(_=`zaal ${k[2]=="#"?"#":Number(k[2])}`,v=!0),{id:d,name:_,valid:v,probability:b}}const je={key:0,class:"segment-list"},Le=["value"],Pe={key:1},He={class:"flex",style:{"margin-top":"16px"}},Fe=z({__name:"AnnouncementBuilder",props:W({noButton:{type:Boolean,default:!1},playButton:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{},show:{type:Boolean,default:!1},showModifiers:{}}),emits:W(["play"],["update:modelValue","update:show"]),setup(n,{emit:u}){const d=F(n,"modelValue"),_=F(n,"show"),v=u,b=[...new Set(Object.values(A).flatMap(o=>o.sounds))];function k(){d.value.push({spriteName:"",offset:0})}function e(o){return o.charAt(0).toUpperCase()+o.slice(1)}return(o,i)=>{const h=le,V=ne,U=re,C=de,I=te;return a(),c(B,null,[n.noButton?x("",!0):(a(),E(V,he({key:0,class:"secondary announcement-builder-button",onClick:i[0]||(i[0]=D=>_.value=!0)},o.$attrs),{default:r(()=>[ee(o.$slots,"default",{},()=>[f(h,null,{default:r(()=>i[3]||(i[3]=[p("build")])),_:1,__:[3]}),i[4]||(i[4]=s("span",null,"Omroep bewerken",-1))],!0)]),_:3},16)),f(oe,null,{default:r(()=>[_.value?(a(),E(I,{key:0,onDismiss:i[2]||(i[2]=D=>_.value=!1)},{default:r(()=>[i[10]||(i[10]=s("h3",null,"Omroeponderdelen",-1)),d.value.length?(a(),c("ul",je,[(a(!0),c(B,null,R(d.value,(D,l)=>(a(),c("li",{class:"segment",key:l},[f(U,{class:"no-label",identifier:"spriteName"+l,modelValue:D.spriteName,"onUpdate:modelValue":M=>D.spriteName=M,spellcheck:"false",autocomplete:"off",autocapitalize:"off"},{datalist:r(()=>[(a(),c(B,null,R(b,M=>s("option",{key:M,value:M},O(e($(q)(M).name)),9,Le)),64))]),_:2},1032,["identifier","modelValue","onUpdate:modelValue"]),f(C,{class:"no-label",identifier:"offset"+l,modelValue:D.offset,"onUpdate:modelValue":M=>D.offset=M,unit:"ms"},null,8,["identifier","modelValue","onUpdate:modelValue"]),f(h,{style:{float:"right",cursor:"pointer",padding:"2px"},onClick:M=>d.value.splice(l,1)},{default:r(()=>i[5]||(i[5]=[p(" delete")])),_:2,__:[5]},1032,["onClick"])]))),128))])):(a(),c("p",Pe," Geen onderdelen gevonden. ")),s("div",He,[f(V,{class:"secondary add-rule",onClick:k},{default:r(()=>[f(h,null,{default:r(()=>i[6]||(i[6]=[p("add")])),_:1,__:[6]}),i[7]||(i[7]=p(" Nieuw onderdeel "))]),_:1,__:[7]}),n.playButton?(a(),E(V,{key:0,class:"secondary add-rule",onClick:i[1]||(i[1]=D=>v("play"))},{default:r(()=>[f(h,null,{default:r(()=>i[8]||(i[8]=[p("play_arrow")])),_:1,__:[8]}),i[9]||(i[9]=p(" Afspelen "))]),_:1,__:[9]})):x("",!0)])]),_:1,__:[10]})):x("",!0)]),_:1})],64)}}}),pe=Z(Fe,[["__scopeId","data-v-74e20feb"]]),qe=["for"],ze={class:"title"},Ge=["id"],Xe=z({__name:"InputSelect",props:W({identifier:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const u=F(n,"modelValue");return(d,_)=>(a(),c("label",{class:"input select-input",for:d.identifier},[s("div",ze,[ee(d.$slots,"default",{},void 0,!0)]),me(s("select",{id:d.identifier,"onUpdate:modelValue":_[0]||(_[0]=v=>u.value=v)},[ee(d.$slots,"options",{},void 0,!0)],8,Ge),[[be,u.value]])],8,qe))}}),We=Z(Xe,[["__scopeId","data-v-15be24ca"]]),Je={key:1,class:"input timing-input"},Ze=["value"],Ke={key:2},Ye={style:{opacity:".5"}},Qe={key:0},et={key:1},tt={key:2},lt={style:{opacity:".5"}},ot={key:0,style:{opacity:".5"}},nt={key:0},it={key:1},st={key:2},at={key:3},ut={key:4},rt={key:1,style:{opacity:".5"}},dt={key:1},mt=z({__name:"RuleList",props:W({toggleOnly:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const u=H(!1),d=H(!1),_=F(n,"modelValue"),v={scheduledTime:"inloop",showTime:"start",mainShowTime:"start hoofdfilm",creditsTime:"aftiteling",endTime:"einde voorstelling"};function b(){const k={id:Date.now().toString(),enabled:!0,segments:[{spriteName:"chime",offset:-800},{spriteName:"auditorium#",offset:0}],trigger:{property:"scheduledTime",preponeMinutes:0},filter:{plfOnly:!1,lastShowOnly:!1,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}};_.value.push(k)}return(k,e)=>{const o=le,i=fe,h=de,V=We,U=pe,C=re,I=te,D=ne;return a(),c(B,null,[_.value.length?(a(),c("ul",{key:0,class:J(["rule-list",{"toggle-only":n.toggleOnly}])},[(a(!0),c(B,null,R(_.value,(l,M)=>(a(),c("li",{class:J(["rule",{active:l.enabled}]),key:l.id},[n.toggleOnly?x("",!0):(a(),E(o,{key:0,style:{float:"right",cursor:"pointer",padding:"2px"},onClick:m=>_.value.splice(M,1)},{default:r(()=>e[4]||(e[4]=[p(" delete")])),_:2,__:[4]},1032,["onClick"])),f(i,{class:"toggler",identifier:l.id+"enabled",modelValue:l.enabled,"onUpdate:modelValue":m=>l.enabled=m},{default:r(()=>[p(O(l.name||"Eigen regel"),1)]),_:2},1032,["identifier","modelValue","onUpdate:modelValue"]),n.toggleOnly?(a(),c("p",Ke,[e[10]||(e[10]=p(" Timing: ")),s("span",Ye,[l.trigger.preponeMinutes>0?(a(),c("span",Qe,[s("b",null,O(l.trigger.preponeMinutes)+" min.",1),e[7]||(e[7]=p(" vóór"))])):l.trigger.preponeMinutes<0?(a(),c("span",et,[s("b",null,O(-l.trigger.preponeMinutes)+" min.",1),e[8]||(e[8]=p(" na"))])):(a(),c("span",tt,"bij")),e[9]||(e[9]=p()),s("b",null,O(v[l.trigger.property]),1)])])):(a(),c("div",Je,[e[6]||(e[6]=s("span",null,"Timing:",-1)),s("span",null,[f(h,{class:"no-label",identifier:l.id+"triggerPreponeMinutes",unit:"min.",modelValue:l.trigger.preponeMinutes,"onUpdate:modelValue":m=>l.trigger.preponeMinutes=m},null,8,["identifier","modelValue","onUpdate:modelValue"]),e[5]||(e[5]=p(" vóór ")),f(V,{class:"no-label",identifier:l.id+"triggerProperty",modelValue:l.trigger.property,"onUpdate:modelValue":m=>l.trigger.property=m},{options:r(()=>[(a(),c(B,null,R(v,(m,G)=>s("option",{key:G,value:G},O(m),9,Ze)),64))]),_:2},1032,["identifier","modelValue","onUpdate:modelValue"])])])),s("a",{onClick:e[0]||(e[0]=()=>{n.toggleOnly||(u.value=!0)})},[e[11]||(e[11]=s("u",null,"Omroep",-1)),e[12]||(e[12]=p(": ")),s("span",lt,O(l.segments.map(m=>$(q)(m.spriteName).name).join(" - ")),1)]),f(U,{"no-button":"",modelValue:l.segments,"onUpdate:modelValue":m=>l.segments=m,show:u.value,"onUpdate:show":e[1]||(e[1]=m=>u.value=m)},{default:r(()=>[f(o,null,{default:r(()=>e[13]||(e[13]=[p("build")])),_:1,__:[13]}),s("span",null,O(l.segments.map(m=>$(q)(m.spriteName).name).join(" - ")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","show"]),e[27]||(e[27]=s("br",null,null,-1)),!n.toggleOnly||Object.values(l.filter).some(m=>typeof m=="string"?m.length>0:m)?(a(),c("a",{key:3,onClick:e[2]||(e[2]=()=>{n.toggleOnly||(d.value=!0)})},[e[19]||(e[19]=s("u",null,"Filter",-1)),e[20]||(e[20]=p(": ")),Object.values(l.filter).some(m=>typeof m=="string"?m.length>0:m)?(a(),c("span",ot,[e[18]||(e[18]=p(" alleen ")),l.filter.lastShowOnly?(a(),c("b",nt,"de laatste ")):x("",!0),l.filter.firstShowOnly?(a(),c("b",it,"de eerste ")):x("",!0),l.filter.plfOnly?(a(),c("b",st,"4DX-")):x("",!0),p("voorstelling"+O(l.filter.lastShowOnly||l.filter.firstShowOnly?"":"en")+" ",1),l.filter.playlistTitleIncludes?(a(),c("span",at,[e[14]||(e[14]=p("met ")),s("b",null,O(l.filter.playlistTitleIncludes),1),e[15]||(e[15]=p(" in de titel "))])):x("",!0),l.filter.playlistTitleExcludes?(a(),c("span",ut,[e[16]||(e[16]=p("zonder ")),s("b",null,O(l.filter.playlistTitleExcludes),1),e[17]||(e[17]=p(" in de titel "))])):x("",!0)])):(a(),c("span",rt,"elke voorstelling"))])):x("",!0),f(oe,null,{default:r(()=>[d.value?(a(),E(I,{key:0,onDismiss:e[3]||(e[3]=m=>d.value=!1),class:"filters"},{default:r(()=>[e[26]||(e[26]=s("h3",null,"Filter",-1)),f(i,{identifier:l.id+"plfOnly",modelValue:l.filter.plfOnly,"onUpdate:modelValue":m=>l.filter.plfOnly=m},{default:r(()=>e[21]||(e[21]=[p(" Alleen 4DX-voorstellingen ")])),_:2,__:[21]},1032,["identifier","modelValue","onUpdate:modelValue"]),f(i,{identifier:l.id+"lastShowOnly",modelValue:l.filter.lastShowOnly,"onUpdate:modelValue":m=>l.filter.lastShowOnly=m},{default:r(()=>e[22]||(e[22]=[p(" Alleen de laatste overeenkomst ")])),_:2,__:[22]},1032,["identifier","modelValue","onUpdate:modelValue"]),f(i,{identifier:l.id+"firstShowOnly",modelValue:l.filter.firstShowOnly,"onUpdate:modelValue":m=>l.filter.firstShowOnly=m},{default:r(()=>e[23]||(e[23]=[p(" Alleen de eerste overeenkomst ")])),_:2,__:[23]},1032,["identifier","modelValue","onUpdate:modelValue"]),f(C,{identifier:l.id+"playlistTitleIncludes",modelValue:l.filter.playlistTitleIncludes,"onUpdate:modelValue":m=>l.filter.playlistTitleIncludes=m},{default:r(()=>e[24]||(e[24]=[p(" Titel moet bevatten ")])),_:2,__:[24]},1032,["identifier","modelValue","onUpdate:modelValue"]),f(C,{identifier:l.id+"playlistTitleExcludes",modelValue:l.filter.playlistTitleExcludes,"onUpdate:modelValue":m=>l.filter.playlistTitleExcludes=m},{default:r(()=>e[25]||(e[25]=[p(" Titel mag niet bevatten ")])),_:2,__:[25]},1032,["identifier","modelValue","onUpdate:modelValue"])]),_:2,__:[26]},1024)):x("",!0)]),_:2},1024)],2))),128))],2)):(a(),c("p",dt," Geen regels gevonden. ")),n.toggleOnly?x("",!0):(a(),E(D,{key:2,class:"secondary add-rule",onClick:b},{default:r(()=>[f(o,null,{default:r(()=>e[28]||(e[28]=[p("add")])),_:1,__:[28]}),e[29]||(e[29]=p(" Nieuwe regel "))]),_:1,__:[29]}))],64)}}}),ft=Z(mt,[["__scopeId","data-v-b1e49e68"]]),pt=z({__name:"VoicesSelector",props:{modelValue:{default:["default"]},modelModifiers:{}},emits:["update:modelValue"],setup(n){const u=F(n,"modelValue");function d(_,v){if(_)u.value.push(v);else{const b=u.value.indexOf(v);b>-1&&u.value.splice(b,1)}}return(_,v)=>{const b=fe;return a(!0),c(B,null,R($(A),(k,e)=>(a(),E(b,{key:e,modelValue:u.value.includes(e),"onUpdate:modelValue":o=>d(o,e),identifier:e},{default:r(()=>[p(O(k.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","identifier"]))),128)}}});function gt(n){const u=n.numberOfChannels,d=n.sampleRate,_=16,v=u*(_/8),b=d*v,k=new ArrayBuffer(44+n.length*v),e=new DataView(k);let o=0;function i(h){for(let V=0;V<h.length;V++)e.setUint8(o++,h.charCodeAt(V))}i("RIFF"),e.setUint32(o,36+n.length*v,!0),o+=4,i("WAVE"),i("fmt "),e.setUint32(o,16,!0),o+=4,e.setUint16(o,1,!0),o+=2,e.setUint16(o,u,!0),o+=2,e.setUint32(o,d,!0),o+=4,e.setUint32(o,b,!0),o+=4,e.setUint16(o,v,!0),o+=2,e.setUint16(o,_,!0),o+=2,i("data"),e.setUint32(o,n.length*v,!0),o+=4;for(let h=0;h<n.length;h++)for(let V=0;V<u;V++){const U=Math.max(-1,Math.min(1,n.getChannelData(V)[h]));e.setInt16(o,U<0?U*32768:U*32767,!0),o+=2}return new Blob([e],{type:"audio/wav"})}async function ct(n){const u=new AudioContext,d=new Map;for(const{voice:o}of n)if(!d.has(o)){const h=await(await fetch(o.file)).arrayBuffer(),V=await u.decodeAudioData(h);d.set(o,V)}let _=0,v=0;for(let o=0;o<n.length;o++){const i=n[o],[h,V]=i.voice.sprite[i.spriteName]||[0,0],U=_+V/1e3;U>v&&(v=U),_+=(V+(i.offset||0))/1e3}const b=new OfflineAudioContext(2,Math.ceil(v*44100),44100);_=0;for(let o=0;o<n.length;o++){const i=n[o],[h,V]=i.voice.sprite[i.spriteName]||[0,0],U=d.get(i.voice);if(!U)return;const C=b.createBufferSource();C.buffer=U;const I=Math.max(0,_);C.start(I,h/1e3,V/1e3),C.connect(b.destination),_+=(V+(i.offset||0))/1e3}const k=await b.startRendering(),e=gt(k);return URL.createObjectURL(e)}const yt={class:"flex",style:{"flex-wrap":"wrap-reverse"}},_t={style:{flex:"50% 1 1"}},vt={id:"upcoming-announcements"},wt={class:"room"},Vt={class:"title"},Tt={class:"time"},ht={class:"flex chips"},bt=["onDblclick"],St={key:"0"},Ot={key:1},kt={style:{position:"relative"}},$t={key:0},Ut={key:0,class:"dropzone"},xt=z({__name:"AnnouncerView",setup(n){const u=Ne(),d=$e("now"),_=ue("main"),v=ue("audios"),b=H(!1),k=Q("default-rules",[{id:"plfStart",name:"4DX-inloop",segments:[{spriteName:"chime",offset:-800},{spriteName:"start",offset:0},{spriteName:"auditorium#",offset:0}],enabled:!0,trigger:{property:"scheduledTime",preponeMinutes:15},filter:{plfOnly:!0,lastShowOnly:!1,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}},{id:"start",name:"Start",segments:[{spriteName:"chime",offset:-800},{spriteName:"start",offset:0},{spriteName:"auditorium#",offset:0}],enabled:!1,trigger:{property:"scheduledTime",preponeMinutes:0},filter:{plfOnly:!1,lastShowOnly:!1,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}},{id:"mainShow",name:"Start hoofdfilm",segments:[{spriteName:"chime",offset:-800},{spriteName:"mainshow",offset:0},{spriteName:"auditorium#",offset:0}],enabled:!1,trigger:{property:"mainShowTime",preponeMinutes:0},filter:{plfOnly:!1,lastShowOnly:!1,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}},{id:"credits",name:"Aftiteling",segments:[{spriteName:"chime",offset:-800},{spriteName:"credits",offset:0},{spriteName:"auditorium#",offset:0}],enabled:!0,trigger:{property:"creditsTime",preponeMinutes:1},filter:{plfOnly:!1,lastShowOnly:!1,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}},{id:"end",name:"Einde voorstelling",segments:[{spriteName:"chime",offset:-800},{spriteName:"end",offset:0},{spriteName:"auditorium#",offset:0}],enabled:!1,trigger:{property:"endTime",preponeMinutes:0},filter:{plfOnly:!1,lastShowOnly:!1,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}},{id:"finalMainShowStart",name:"Start laatste hoofdfilm",segments:[{spriteName:"chime",offset:-800},{spriteName:"finalshow",offset:0}],enabled:!1,trigger:{property:"mainShowTime",preponeMinutes:0},filter:{plfOnly:!1,lastShowOnly:!0,firstShowOnly:!1,playlistTitleIncludes:"",playlistTitleExcludes:""}}],localStorage,{mergeDefaults:!0}),e=Q("custom-rules",[],localStorage,{mergeDefaults:!0}),o=Q("preferred-voices",["default"],localStorage,{mergeDefaults:!0}),i=H([{spriteName:"chime",offset:-800}]),h=H([]);u.$subscribe(U,{deep:!0});let V=null;Se(()=>{U(),V=setInterval(C,1e4)}),Oe(()=>{V&&clearInterval(V)});function U(){v.value.innerHTML="";let y=[];for(const t of[...k.value,...e.value]){if(!t.enabled)continue;let w=[];u.table.forEach((T,N)=>{if(I(T,N,t.filter)){const S={time:new Date(T[t.trigger.property].getTime()-(t.trigger.preponeMinutes||0)*6e4-5e3),show:T,segments:t.segments.map(j=>({...j,spriteName:j.spriteName.replace("#",`${String(T.auditoriumNumber).padStart(2,"0")}`)})),audio:null};S.time.getTime()>Date.now()&&w.push(S)}}),w.sort((T,N)=>T.time.getTime()-N.time.getTime()),t.filter.firstShowOnly&&(w=w.slice(0,1)),t.filter.lastShowOnly&&(w=w.slice(-1)),y.push(...w)}h.value=y.sort((t,w)=>t.time.getTime()-w.time.getTime()),C()}async function C(){for(const y of h.value){const t=y.time.getTime()-Date.now()-1e3;if(t>-1e3&&t<1e4&&!y.audio){const w=l(y.segments,o.value.map(T=>A[T]));y.audio=await M(w),v.value.appendChild(y.audio),setTimeout(()=>{var N;const T=Array.from(v.value.children).find(S=>S!==y.audio&&!S.paused);T?T.addEventListener("ended",()=>{var S;(S=y.audio)==null||S.play()},{once:!0}):(N=y.audio)==null||N.play()},Math.max(0,t))}}}function I(y,t,w){let T=!0;return w.plfOnly&&!y.auditorium.includes("4DX")&&(T=!1),w.playlistTitleIncludes&&!y.title.toLowerCase().includes(w.playlistTitleIncludes.toLowerCase())&&(T=!1),w.playlistTitleExcludes&&y.title.toLowerCase().includes(w.playlistTitleExcludes.toLowerCase())&&(T=!1),T}function D(y){return y<6e4?Math.floor(y/1e3)+" s":y<6e5?Math.floor(y/6e4)+":"+String(Math.floor(y%6e4/1e3)).padStart(2,"0")+" min":y<36e5?Math.floor(y/6e4)+" min":Math.floor(y/36e5)+":"+String(Math.floor(y%36e5/6e4)).padStart(2,"0")+" h"}function l(y,t){const w=t.sort(()=>.5-Math.random()),T=Object.values(A);for(const N of w)if(y.every(S=>S.spriteName==="chime"||N.sprite[S.spriteName]))return y.map(S=>({...S,voice:S.spriteName==="chime"?A.default:N}));return y.map(N=>{const S=[...w,...T].find(j=>j.sprite[N.spriteName]);return{...N,voice:(N.spriteName==="chime"?A.default:S)||A.default}})}function M(y){return new Promise(async t=>{const w=await ct(y),T=new Audio(w);T.addEventListener("ended",()=>{T.remove()}),t(T)})}async function m(y,t=o.value.map(w=>A[w])){const w=l(y,t);(await M(w)).play()}const{isOverDropZone:G}=Ce(_,{onDrop:u.filesUploaded,multiple:!1});return(y,t)=>{const w=ke,T=Me,N=Ae,S=le,j=pt,ge=pe,ie=ne,ce=De,se=ft,ae=Te,ye=Ve,_e=te;return a(),c("main",{ref_key:"main",ref:_},[f(w),f(T),s("section",null,[s("div",yt,[s("div",_t,[t[9]||(t[9]=s("h2",null,"Geplande omroepen",-1)),s("div",vt,[f(Ue,{name:"list"},{default:r(()=>[(a(!0),c(B,null,R(h.value,g=>me((a(),c("div",{class:J(["film",{announcing:g.audio&&!g.audio.paused}]),key:g.time.getTime()},[s("div",wt,O(g.show.auditorium==="PULR 8"||g.show.auditorium==="Rooftop"?"RT":g.show.auditorium.replace(/^\w+\s/,"")),1),s("div",Vt,O(g.show.title),1),s("div",Tt,O($(Y)(g.show.scheduledTime,"HH:mm"))+" – "+O($(Y)(g.show.endTime,"HH:mm:ss")),1),s("div",ht,[(a(!0),c(B,null,R(g.show.extras,L=>(a(),E(N,{class:J({"translucent-white":L.match(/\(.+\)/)})},{default:r(()=>[p(O(L.replace(/\((.+)\)/,"$1")),1)]),_:2},1032,["class"]))),256))]),s("div",{class:"announcement",onDblclick:L=>m(g.segments),style:{display:"grid","grid-template-columns":"64px 130px 1fr"}},[f(S,null,{default:r(()=>t[8]||(t[8]=[p("schedule")])),_:1,__:[8]}),s("div",null,O($(Y)(g.time,"HH:mm:ss"))+" ("+O(D(g.time.getTime()-$(d).getTime()))+") ",1),s("div",null," '"+O(g.segments.map(L=>$(q)(L.spriteName).name).join(" "))+"' ",1)],40,bt)],2)),[[xe,g.time.getTime()-$(d).getTime()>-5e3||g.audio&&!g.audio.paused]])),128)),h.value.filter(g=>$(d).getTime()-g.time.getTime()<1e4).length<1?(a(),c("p",St,"Er zijn geen omroepen gepland.")):x("",!0),$(u).table.length<1?(a(),c("p",Ot,"Upload eerst een bestand.")):x("",!0)]),_:1})])]),f(ce,{style:{flex:"30% 1 1"}},{default:r(()=>[t[17]||(t[17]=s("h2",null,"Opties",-1)),s("fieldset",null,[t[10]||(t[10]=s("legend",null,"Stemmen",-1)),f(j,{modelValue:$(o),"onUpdate:modelValue":t[0]||(t[0]=g=>K(o)?o.value=g:null)},null,8,["modelValue"])]),s("fieldset",kt,[t[13]||(t[13]=s("legend",null,"Handmatige omroep",-1)),f(ge,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=g=>i.value=g),"play-button":"",class:"full",onPlay:t[2]||(t[2]=g=>m(i.value))},{default:r(()=>[f(S,null,{default:r(()=>t[11]||(t[11]=[p("build")])),_:1,__:[11]}),t[12]||(t[12]=s("span",null,"Omroep maken",-1))]),_:1,__:[12]},8,["modelValue"])]),s("fieldset",null,[t[16]||(t[16]=s("legend",null,"Regels",-1)),f(ie,{class:"secondary full",onClick:t[3]||(t[3]=g=>b.value=!0)},{default:r(()=>[f(S,null,{default:r(()=>t[14]||(t[14]=[p("edit")])),_:1,__:[14]}),s("span",null,[t[15]||(t[15]=p("Regels bewerken ")),$(e).filter(g=>g.enabled).length?(a(),c("small",$t,"(eigen regels: "+O($(e).filter(g=>g.enabled).length)+" actief)",1)):x("",!0)])]),_:1})])]),_:1,__:[17]})])]),f(oe,null,{default:r(()=>[b.value?(a(),E(_e,{key:0,onDismiss:t[7]||(t[7]=g=>b.value=!1)},{default:r(()=>[f(ye,null,{default:r(()=>[f(ae,{value:"Standaardregels"},{default:r(()=>[f(se,{modelValue:$(k),"onUpdate:modelValue":t[4]||(t[4]=g=>K(k)?k.value=g:null),toggleOnly:!0},null,8,["modelValue"])]),_:1}),f(ae,{value:"Eigen regels"},{default:r(()=>[f(se,{modelValue:$(e),"onUpdate:modelValue":t[5]||(t[5]=g=>K(e)?e.value=g:null),toggleOnly:!1},null,8,["modelValue"])]),_:1})]),_:1}),f(ie,{class:"full",onClick:t[6]||(t[6]=g=>{U(),b.value=!1}),style:{"margin-top":"16px"}},{default:r(()=>[f(S,null,{default:r(()=>t[18]||(t[18]=[p("refresh")])),_:1,__:[18]}),t[19]||(t[19]=s("span",null,"Omroepen klaarzetten",-1))]),_:1,__:[19]})]),_:1})):x("",!0)]),_:1}),$(G)?(a(),c("div",Ut," Laat los om bestand te uploaden ")):x("",!0),s("div",{ref_key:"audios",ref:v,id:"audios"},null,512)],512)}}}),Rt=Z(xt,[["__scopeId","data-v-759ff94c"]]);export{Rt as default};

import{d as A,A as b,B as k,c as v,h as r,D as F,a as R,M as C,b as w,z as P,N as L,r as y,O as D,j as u,m as T,k as g,f as x,g as N,w as B}from"./index-DoatqyxQ.js";import{c as V}from"./FileUploadButton-2SIyWTRm.js";import{n as I}from"./nl-CLDuTpis.js";const z=["for"],G={class:"title"},H=["id"],J=A({__name:"InputCheckbox",props:b({identifier:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=k(t,"modelValue");return(a,l)=>(w(),v("label",{class:"input",for:a.identifier},[r("div",G,[R(a.$slots,"default",{},void 0,!0)]),F(r("input",{type:"checkbox",id:a.identifier,"onUpdate:modelValue":l[0]||(l[0]=n=>e.value=n)},null,8,H),[[C,e.value]])],8,z))}}),se=P(J,[["__scopeId","data-v-fa1944bc"]]),Y=L("tmsSchedule",()=>{const t=y([]),e=y({});async function a(n){return new Promise(async(m,_)=>{const o=n[0];if(!o||!W(o))return;for(;t.value.length;)t.value.pop();e.value={};const s=(await o.text()).split(`
`),d=M(s[0]),U=s.slice(1).map(i=>{const h=M(i);return d.reduce((p,$,O)=>{var S;return p[$.trim()]=(S=h[O])==null?void 0:S.trim(),p},{})}).map(i=>{var h,p;return{title:E(i.PLAYLIST).title,extras:E(i.PLAYLIST).extras,playlist:i.PLAYLIST,feature:i.FEATURE,featureRating:i.FEATURE_RATING,auditorium:i.AUDITORIUM,auditoriumNumber:parseInt((p=(h=i.AUDITORIUM)==null?void 0:h.replace(/^\w+\s/,""))==null?void 0:p.split(" ")[0])||0,scheduledTime:f(i.SCHEDULED_TIME),showTime:f(i.SHOW_TIME),mainShowTime:f(i.FEATURE_TIME),creditsTime:f(i.CREDITS_TIME),endTime:f(i.END_TIME),duration:i.DURATION}});t.value.push(...U),e.value={name:o.name,type:o.type,lastModified:o.lastModified,uploadedDate:Date.now(),size:o.size},m()})}async function l(n){return new Promise((m,_)=>{var s;if(!n||!((s=Object.values(n))!=null&&s[0])||!("timetable"in n)||!("metadata"in n))return _();for(;t.value.length;)t.value.pop();e.value={};const o=n,c=o.timetable.map(d=>({...d,scheduledTime:new Date(d.scheduledTime),showTime:new Date(d.showTime),mainShowTime:new Date(d.mainShowTime),creditsTime:new Date(d.creditsTime),endTime:new Date(d.endTime)}));t.value.push(...c),e.value=o.metadata,m()})}return{table:t,metadata:e,addFiles:a,loadFromJson:l}});function W(t){return t.type==="text/csv"||t.type==="application/vnd.ms-excel"||t.name.endsWith(".csv")}function M(t){const e=[];let a="",l=!1;for(const n of t)n==='"'?l=!l:n===","&&!l?(e.push(a.trim()),a=""):a+=n;return e.push(a.trim()),e}function f(t){const e=new Date;e.getHours()<6&&e.setDate(e.getDate()-1);const a=new Date(`${e.toDateString()} ${t}`);return a.getHours()<6&&a.setDate(a.getDate()+1),a}function E(t){var a;let e=((a=t.match(/(\s((4DX)|(ATMOS)|(IMX)|(3D)|(Music)|(ROOFTOP)|(PrideNight)|(Ladies)|(Premiere)|(\([A-Z]+\))))+/))==null?void 0:a[0].slice(1))||"";return{extras:e.length>0?e.split(" "):[],title:t.replace(e,"").trim()}}const X={id:"upload"},Q={class:"flex block"},Z={key:0,style:{"flex-grow":"1"}},q={key:1,style:{"flex-grow":"1"}},K={class:"buttons"},j=A({__name:"TmsScheduleUploadSection",setup(t){const e=Y(),a=D("server-url",""),l=D("server-username",""),n=D("server-password","");m();async function m(){const s=await(await fetch(`${a.value}/users/${l.value}/timetable`,{headers:{Authorization:"Basic "+btoa(`${l.value}:${n.value}`)}})).json();e.loadFromJson(s)}async function _(){await fetch(`${a.value}/users/${l.value}/timetable`,{method:"POST",headers:{Authorization:"Basic "+btoa(`${l.value}:${n.value}`),"Content-Type":"application/json"},body:JSON.stringify({timetable:e.table,metadata:e.metadata})})}async function o(c){await e.addFiles(c),_()}return(c,s)=>{const d=V;return w(),v("section",X,[s[4]||(s[4]=r("h2",null,"Gegevensbestand",-1)),r("div",Q,["name"in u(e).metadata?(w(),v("p",Z,[T(g(u(e).metadata.name)+" ",1),s[1]||(s[1]=r("br",null,null,-1)),r("small",null,[T(" Laatst gewijzigd op "+g(u(x)(new Date(u(e).metadata.lastModified),"PPPpp",{locale:u(I)}))+" ",1),s[0]||(s[0]=r("br",null,null,-1)),T(" Geüpload op "+g(u(x)(new Date(u(e).metadata.uploadedDate),"PPPpp",{locale:u(I)})),1)])])):(w(),v("p",q,s[2]||(s[2]=[T(" Geen bestand geüpload "),r("br",null,null,-1),r("small",null,"Upload hiernaast een CSV-bestand uit RosettaBridge (met optie 'times only')",-1)]))),r("div",K,[N(d,{id:"file-upload-area",class:"large",onFilesUploaded:o,accept:"text/csv,.csv"},{default:B(()=>s[3]||(s[3]=[r("small",null,"Of sleep een bestand hiernaartoe",-1)])),_:1})])])])}}}),ne=P(j,[["__scopeId","data-v-6e200062"]]);export{ne as _,se as a,Y as u};
